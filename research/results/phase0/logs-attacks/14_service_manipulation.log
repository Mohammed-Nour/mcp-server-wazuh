===============================================================================
[1;33mATTACK #14: Service Manipulation[0m
===============================================================================
Target: ec2-54-204-182-4.compute-1.amazonaws.com
Service: rsyslog
Category: System

[0;32m[*] Attack started at: 2026-01-05T18:54:45+03:00[0m
[*] Attempting to stop and disable a service...

[*] Running attack via SSH...
ERROR: ld.so: object 'malicious' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.
ERROR: ld.so: object 'preload' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.
[*] Checking service  status
[*] Stopping 
[*] Disabling 
[*] Restarting  to restore state
[*] Final status:
â— ip-172-31-28-229
    State: degraded
     Jobs: 0 queued
   Failed: 1 units
    Since: Mon 2026-01-05 13:39:15 UTC; 2h 15min ago
   CGroup: /
           â”œâ”€user.slice 
           â”‚ â””â”€user-1000.slice 
           â”‚   â”œâ”€user@1000.service â€¦
           â”‚   â”‚ â””â”€init.scope 
           â”‚   â”‚   â”œâ”€1789 /lib/systemd/systemd --user
           â”‚   â”‚   â””â”€1791 (sd-pam)
           â”‚   â”œâ”€session-24.scope 
           â”‚   â”‚ â”œâ”€4549 sshd: ubuntu [priv]
           â”‚   â”‚ â”œâ”€4623 sshd: ubuntu@notty
           â”‚   â”‚ â”œâ”€4624 bash -c 
#!/bin/bash
echo "[*] Checking service $SERVICE_NAME status"
sudo systemctl status $SERVICE_NAME >/dev/null 2>&1 || echo "[!] Service $SERVICE_NAME may not exist"

echo "[*] Stopping $SERVICE_NAME"
sudo systemctl stop $SERVICE_NAME 2>/dev/null || true

echo "[*] Disabling $SERVICE_NAME"
sudo systemctl disable $SERVICE_NAME 2>/dev/null || true

echo "[*] Restarting $SERVICE_NAME to restore state"
sudo systemctl enable $SERVICE_NAME 2>/dev/null || true
sudo systemctl start $SERVICE_NAME 2>/dev/null || true

echo "[*] Final status:"
sudo systemctl status $SERVICE_NAME 2>/dev/null || true
           â”‚   â”‚ â”œâ”€4635 sudo systemctl status
           â”‚   â”‚ â””â”€4636 systemctl status
           â”‚   â””â”€session-1.scope 
           â”‚     â”œâ”€1758 sshd: ubuntu [priv]
           â”‚     â”œâ”€1873 sshd: ubuntu@pts/0
           â”‚     â””â”€1874 -bash
           â”œâ”€init.scope 
           â”‚ â””â”€1 /sbin/init
           â””â”€system.slice 
             â”œâ”€irqbalance.service 
             â”‚ â””â”€398 /usr/sbin/irqbalance --foreground
             â”œâ”€apache2.service 
             â”‚ â”œâ”€ 517 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€ 584 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€ 589 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€ 590 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€ 594 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€ 602 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€1884 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€1885 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€2054 /usr/sbin/apache2 -k start
             â”‚ â”œâ”€2055 /usr/sbin/apache2 -k start
             â”‚ â””â”€2056 /usr/sbin/apache2 -k start
             â”œâ”€systemd-networkd.service 
             â”‚ â””â”€344 /lib/systemd/systemd-networkd
             â”œâ”€systemd-udevd.service 
             â”‚ â””â”€176 /lib/systemd/systemd-udevd
             â”œâ”€cron.service 
             â”‚ â””â”€385 /usr/sbin/cron -f -P
             â”œâ”€system-serial\x2dgetty.slice 
             â”‚ â””â”€serial-getty@ttyS0.service 
             â”‚   â””â”€420 /sbin/agetty -o -p -- \u --keep-baud 115200,57600,38400,9600 ttyS0 vt220
             â”œâ”€wazuh-agent.service 
             â”‚ â”œâ”€554 /var/ossec/bin/wazuh-execd
             â”‚ â”œâ”€678 /var/ossec/bin/wazuh-agentd
             â”‚ â”œâ”€722 /var/ossec/bin/wazuh-syscheckd
             â”‚ â”œâ”€822 /var/ossec/bin/wazuh-logcollector
             â”‚ â””â”€833 /var/ossec/bin/wazuh-modulesd
             â”œâ”€polkit.service 
             â”‚ â””â”€509 /usr/libexec/polkitd --no-debug
             â”œâ”€networkd-dispatcher.service 
             â”‚ â””â”€399 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers
             â”œâ”€multipathd.service 
             â”‚ â””â”€173 /sbin/multipathd -d -s
             â”œâ”€snap.amazon-ssm-agent.amazon-ssm-agent.service 
             â”‚ â””â”€402 /snap/amazon-ssm-agent/12322/amazon-ssm-agent
             â”œâ”€systemd-journald.service 
             â”‚ â””â”€133 /lib/systemd/systemd-journald
             â”œâ”€unattended-upgrades.service 
             â”‚ â””â”€500 /usr/bin/python3 /usr/share/unattended-upgrades/unattended-upgrade-shutdown --wait-for-signal
             â”œâ”€ssh.service 
             â”‚ â””â”€665 sshd: /usr/sbin/sshd -D -o AuthorizedKeysCommand /usr/share/ec2-instance-connect/eic_run_authorized_keys %u %f -o AuthorizedKeysCommandUser ec2-instance-connect [listener] 0 of 10-100 startups
             â”œâ”€snapd.service 
             â”‚ â””â”€406 /snap/snapd/current/usr/lib/snapd/snapd
             â”œâ”€vsftpd.service 
             â”‚ â””â”€415 /usr/sbin/vsftpd /etc/vsftpd.conf
             â”œâ”€rsyslog.service 
             â”‚ â””â”€401 /usr/sbin/rsyslogd -n -iNONE
             â”œâ”€chrony.service 
             â”‚ â”œâ”€474 /usr/sbin/chronyd -F 1
             â”‚ â””â”€478 /usr/sbin/chronyd -F 1
             â”œâ”€systemd-resolved.service 
             â”‚ â””â”€346 /lib/systemd/systemd-resolved
             â”œâ”€acpid.service 
             â”‚ â””â”€379 /usr/sbin/acpid
             â”œâ”€dbus.service 
             â”‚ â””â”€386 @dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
             â”œâ”€system-getty.slice 
             â”‚ â””â”€getty@tty1.service 
             â”‚   â””â”€430 /sbin/agetty -o -p -- \u --noclear tty1 linux
             â””â”€systemd-logind.service 
               â””â”€409 /lib/systemd/systemd-logind

===============================================================================
[0;32m[âœ“] Attack completed[0m
===============================================================================
End Time: 2026-01-05T18:54:46+03:00
Duration: 1 seconds

Expected Wazuh alerts:
  - Service stop/disable events
  - Potential availability impact (rules 5502/5503/5504)

Data for CSV:
  attack_id: 14
  attack_name: Service Manipulation
  category: System
  attack_start_time: 2026-01-05T18:54:45+03:00
  attack_end_time: 2026-01-05T18:54:46+03:00
